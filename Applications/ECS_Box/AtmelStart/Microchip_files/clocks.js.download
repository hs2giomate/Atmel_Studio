var ACME=ACME||{};if(!ACME.configurators){ACME.configurators={}}if(!ACME.configurators.clock){ACME.configurators.clock={}}if(!ACME.configurators.clock.dialogs){ACME.configurators.clock.dialogs={}}if(!ACME.configurators.clock.elements){ACME.configurators.clock.elements={}}if(!ACME.configurators.clock.model){ACME.configurators.clock.model={}}if(!ACME.configurators.noclock){ACME.configurators.noclock={}}var Ext=Ext||{};if(!Ext.layout){Ext.layout={}}if(!Ext.layout.container){Ext.layout.container={}}if(!Ext.ux){Ext.ux={}}if(!Ext.ux.layout){Ext.ux.layout={}}(function(e){var b,l=["constructor","toString","valueOf","toLocaleString"],f={},p={},d=0,m,j,r,h,a,g,n,c,i,q=function(){var u,t;j=Ext.Base;r=Ext.ClassManager;for(u=l.length;u-->0;){t=(1<<u);p[f[t]=l[u]]=t}for(u in p){d|=p[u]}d=~d;Function.prototype.$isFunction=1;i=!!(r&&r.addAlias);h=Ext.Class.getPreprocessor("config").fn;a=Ext.Class.getPreprocessor("cachedConfig")&&Ext.Class.getPreprocessor("cachedConfig").fn;g=Ext.Class.getPreprocessor("platformConfig")&&Ext.Class.getPreprocessor("platformConfig").fn;c=Ext.Class.getPreprocessor("privates")&&Ext.Class.getPreprocessor("privates").fn;n=Ext.ClassManager.postprocessors.deprecated&&Ext.ClassManager.postprocessors.deprecated.fn;b=j.$staticMembers;if(!b){b=[];for(m in j){if(j.hasOwnProperty(m)){b.push(m)}}}e.derive=k;return k.apply(this,arguments)},s=function(C,y,B){var v=B.enumerableMembers,z=C.prototype,x,A,w,u,t;if(!y){return}if(i){C.addMembers(y)}else{for(x in y){u=y[x];if(u&&u.$isFunction&&!u.$isClass&&u!==Ext.emptyFn&&u!==Ext.identityFn){t=z.hasOwnProperty(x)&&z[x];if(t){u.$previous=t}z[x]=A=u;A.$owner=C;A.$name=x}else{z[x]=u}}for(w=1;v;w<<=1){if(v&w){v&=~w;x=f[w];z[x]=A=y[x];A.$owner=C;A.$name=x}}}},o=function(x){var t=function w(){return x.apply(this,arguments)||null},v,u;t.prototype=Ext.Object.chain(x.prototype);for(v=b.length;v-->0;){u=b[v];t[u]=j[u]}return t},k=function(y,B,W,t,A,K,z,T,w,M,F){var u=function E(){return this.constructor.apply(this,arguments)||null},V=u,v={enumerableMembers:t&d,onCreated:F,onBeforeCreated:s,aliases:T},I=W.alternateClassName||[],R=Ext.global,N,Q,S,H,P,Z,Y,x,O,D,U,L,G,X,J=r.alternateToName||r.maps.alternateToName,C=r.nameToAlternates||r.maps.nameToAlternates;for(S=b.length;S-->0;){Y=b[S];u[Y]=j[Y]}if(W.$isFunction){W=W(u)}v.data=W;D=W.statics;delete W.statics;W.$className=y;if("$className" in W){u.$className=W.$className}u.extend(B);O=u.prototype;if(A){u.xtype=W.xtype=A[0];O.xtypes=A}O.xtypesChain=K;O.xtypesMap=z;W.alias=T;V.triggerExtended(u,W,v);if(W.onClassExtended){u.onExtended(W.onClassExtended,u);delete W.onClassExtended}if(W.privates&&c){c.call(Ext.Class,u,W)}if(D){if(i){u.addStatics(D)}else{for(U in D){if(D.hasOwnProperty(U)){X=D[U];if(X&&X.$isFunction&&!X.$isClass&&X!==Ext.emptyFn&&X!==Ext.identityFn){u[U]=G=X;G.$owner=u;G.$name=U}u[U]=X}}}}if(W.inheritableStatics){u.addInheritableStatics(W.inheritableStatics);delete W.inheritableStatics}if(O.onClassExtended){V.onExtended(O.onClassExtended,V);delete O.onClassExtended}if(W.platformConfig&&g){g.call(Ext.Class,u,W);delete W.platformConfig}if(W.config){h.call(Ext.Class,u,W)}if(W.cachedConfig&&a){a.call(Ext.Class,u,W);delete W.cachedConfig}if(W.deprecated&&n){n.call(Ext.ClassManager,y,u,W)}v.onBeforeCreated(u,v.data,v);for(S=0,P=w&&w.length;S<P;++S){u.mixin.apply(u,w[S])}for(S=0,P=T.length;S<P;S++){N=T[S];r.setAlias?r.setAlias(u,N):r.addAlias(u,N)}if(W.singleton){V=new u()}if(!(I instanceof Array)){I=[I]}L=r.getName(V);for(S=0,H=I.length;S<H;S++){Q=I[S];r.classes[Q]=V;if(i){r.addAlternate(u,Q)}else{if(L){J[Q]=L;I=C[L]||(C[L]=[]);I.push(Q)}}}for(S=0,P=M.length;S<P;S+=2){Z=M[S];if(!Z){Z=R}Z[M[S+1]]=V}r.classes[y]=V;if(!i){if(L&&L!==y){J[y]=L;I=C[L]||(C[L]=[]);I.push(y)}}delete O.alternateClassName;if(v.onCreated){v.onCreated.call(V,V)}if(y){r.triggerCreated(y)}return V};e.derive=q}(Ext.cmd={}));(Ext.cmd.derive("Ext.layout.container.Center",Ext.layout.container.Fit,{alternateClassName:"Ext.ux.layout.Center",type:"center",percentRe:/^\d+(?:\.\d+)?\%$/,itemCls:"x-center-layout-item",childEls:["targetEl"],renderTpl:['<div id="{ownerId}-targetEl" data-ref="targetEl" class="{targetElCls}" role="presentation">{%this.renderBody(out, values)%}</div>'],targetElCls:"x-center-target",beginLayout:function(b){var j=this,c=j.percentRe,f,h,d,a,k,g,e;Ext.layout.container.Fit.prototype.beginLayout.call(this,b);f=b.childItems;for(d=0,h=f.length;d<h;++d){a=f[d];k=a.target;g=a.widthModel;e=a.heightModel;if(c.test(k.width)){k.getEl().setStyle("width","")}if(c.test(k.height)){k.getEl().setStyle("height","")}}b.targetElContext=b.getEl("targetEl",j)},beginLayoutCycle:function(b,a){var c=this.targetEl;Ext.layout.container.Fit.prototype.beginLayoutCycle.call(this,b,a);c.setStyle("width","");c.setStyle("height","")},getRenderData:function(){var a=Ext.layout.container.Fit.prototype.getRenderData.call(this);a.targetElCls=this.targetElCls;return a},getRenderTarget:function(){return this.targetEl},getItemSizePolicy:function(c,e){var b=this,a=e||b.owner.getSizeModel(),d=b.percentRe,f=((a.width.shrinkWrap||!d.test(c.width))?0:1)|((a.height.shrinkWrap||!d.test(c.height))?0:2);return b.sizePolicies[f]},isItemBoxParent:function(a){return true},isItemShrinkWrap:function(a){return true},calculate:function(b){var a=b.targetElContext,c;Ext.layout.container.Fit.prototype.calculate.call(this,b);c=b.state.info;if(b.widthModel.shrinkWrap){a.setWidth(c.contentWidth)}if(b.heightModel.shrinkWrap){a.setHeight(c.contentHeight)}},getPos:function(c,e,d){var a=d+"Model",b=c.props[d],f=0;if(!c[a].calculated){b+=e.margins[d]}if(!e.ownerContext[a].shrinkWrap){f=Math.round((e.targetSize[d]-b)/2);if(isNaN(f)){this.done=false}}return Math.max(f,0)},positionItemX:function(a,c){var b=this.getPos(a,c,"width");a.setProp("x",b)},positionItemY:function(a,c){var b=this.getPos(a,c,"height");a.setProp("y",b)},setItemHeight:function(b,c){var a=parseFloat(b.target.height)/100;b.setHeight(Math.round((c.targetSize.height-c.margins.height)*a))},setItemWidth:function(b,c){var a=parseFloat(b.target.width)/100;b.setWidth(Math.round((c.targetSize.width-c.margins.width)*a))}},0,0,0,0,["layout.center","layout.ux.center"],0,[Ext.layout.container,"Center",Ext.ux.layout,"Center"],0));(Ext.cmd.derive("ACME.configurators.clock.model.ClockModule",ACME.content.model.device.clocks.ClockNode,{entityName:"ClockModule",fields:[{name:"softwareComponent",type:"auto"}],init:function(){var a=this;ACME.content.model.device.clocks.ClockNode.prototype.init.apply(this,arguments);a.initListeners();a.activeClock=0},initListeners:function(){var e=this,h=e.getSoftwareComponent(),b=h?h.getInstance():null;var g=true,a=false;var d=function(){e.fireEvent("outputFrequencyChanged")};var f=function(){e.fireEvent("inputNodeChanged")};var c=function(j,k){if(j){var i=j?j.clockDomains():null;i.each(function(l){if(k===a){l.un("clockSourceChanged",f,e);l.un("frequencyChanged",d,e)}else{if(k===g){l.on("clockSourceChanged",f,e);l.on("frequencyChanged",d,e)}}})}};if(b){c(b,g)}h.on("instanceChanged",function(i,j){c(j,a);c(i,g)})},reset:function(b){var c=this,a=c.getClockDomains();if(b===undefined){b="defaultSettings"}if(b==="defaultSettings"){a.each(function(d){d.setCurrentValue(d.getDefaultValue())})}else{a.each(function(d){d.setCurrentValue(d.getInitialValue())})}},isClockModule:function(){var b=this,a=b.getClockDomains();return a&&a.count()},getName:function(){return this.get("softwareComponent").getDisplayName()},isEnabled:function(){return true},isAutoEnabled:function(){return true},getClockInstance:function(){var b=this,c=b.getSoftwareComponent(),a=c?c.getInstance():null;return a},getClockDomains:function(){var c=this,b=c.getClockInstance(),a=b?b.clockDomains():null;return a},getClockDomain:function(){var b=this,a=b.getClockDomains();return a?a.getAt(b.activeClock):null},getInputNodeIds:function(){var a=this,b=a.getClockDomain();return b?b.getSources():null},getInputNodeId:function(){var a=this,b=a.getClockDomain();return b?b.getCurrentValue():null},setInputNode:function(b){var a=this,c=a.getClockDomain();if(Ext.Array.contains(c.getSources(),b.getId())){c.setCurrentValue(b.getId());return true}return false},calculateInputFrequency:Ext.emptyFn,calculateOutputFrequency:Ext.emptyFn},0,0,0,0,0,0,[ACME.configurators.clock.model,"ClockModule"],0));(Ext.cmd.derive("ACME.configurators.clock.elements.Draggable",Ext.Mixin,{draggable:true,mixinConfig:{id:"draggableClockBox"},makeDraggable:function(a,d,c){var f=this,j={cX:0,cY:0,nX:0,nY:0,item:null},e=null,h=null;function i(n,m){h=c.up("[scrollable]");if(h){e={cX:n,cY:m,x1:h.getX(),y1:h.getY(),x2:h.getX()+h.getWidth(),y2:h.getY()+h.getHeight(),sX:0,sY:0,scrollX:h.getScrollX(),scrollY:h.getScrollY()}}}function g(n,m){if(e){e.sX=0;var p=e.cX+n;if(p<(e.x1+20)){e.sX=(p-(e.x1+20))*0.1}else{if(p>(e.x2-20)){e.sX=(p-(e.x2-20))*0.1}}e.sY=0;var o=e.cY+m;if(o<(e.y1+20)){e.sY=(o-(e.y1+20))*0.1}else{if(o>(e.y2-20)){e.sY=(o-(e.y2-20))*0.1}}if(e.sX||e.sY){if(!e.scrollTask){e.scrollTask=Ext.TaskManager.start({run:function(){h.scrollBy(e.sX*10,e.sY*10)},scope:f,interval:10})}}else{if(e.scrollTask){Ext.TaskManager.stop(e.scrollTask);e.scrollTask=null}}}}function l(q,n,p){p.stopPropagation();p.preventDefault();i(q,n);var m=a.node.getBoundingClientRect(),o=c.getScale();j.cX=(q-m.left)/o.scale;j.cY=(n-m.top)/o.scale;if(Ext.isFunction(f.dragStartFn)){Ext.callback(f.dragStartFn,f)}}function k(r,q){var m=!j.item;var u=0,t=0;if(h&&e){u=h.getScrollX()-e.scrollX;t=h.getScrollY()-e.scrollY;r+=u;q+=t}if(!m||Math.abs(r)>5||Math.abs(q)>5){var p=c.getScale();if(m){j.item=a.clone();j.item.setCls(a.getCls());var o=0.3;var s=j.item.getBBox(),n=s.width*o,v=s.height*o;j.item.attr({width:n,height:v,"stroke-width":o,opacity:0.8});j.cX-=((n/2)*p.scale);j.cY-=((v/2)*p.scale)}j.nX=j.cX+(r/p.scale);j.nY=j.cY+(q/p.scale);j.item.transform("T"+j.nX+","+j.nY);if(Ext.isFunction(f.dragMoveFn)){Ext.callback(f.dragMoveFn,f,[f.getX()+j.nX+15,f.getY()+j.nY+15,m])}}g(r-u,q-t)}function b(){if(j.item){j.item.remove();j.item=null;if(e){if(e.scrollTask){Ext.TaskManager.stop(e.scrollTask);e.scrollTask=null}e=null}h=null;if(Ext.isFunction(f.dragEndFn)){Ext.callback(f.dragEndFn,f)}}}d.forEach(function(m){m.drag(k,l,b)})},isDropTarget:function(a){var c=this,b=c.getClockNode(),d=a.getClockNode();return b.isAvailableInput(d)||d.isAvailableInput(b)},highlightTargets:function(){var b=this,a=b.getClockNode();Ext.Array.each(b.clockBoxes(),function(c){if(b.isDropTarget(c)||c.getClockNode()===a){c.unDim()}else{c.dim()}});b.dimPaths(0.05,0.4)},highlightConnections:function(){var c=this,b=c.getClockNode(),a=[b];(function d(h){if(h&&h.isEnabled()){var g=ACME.configurators.clock.DrawClocks.getClockBoxForNode(h),f=g.getDropZones();Ext.Array.each(f,function(j){var i=j.getInputNode();if(!Ext.Array.contains(a,i)){a.push(i);d(i)}})}}(b));(function e(g){var f=ACME.configurators.clock.DrawClocks.getClockBoxForNode(g),h=Ext.Array.difference(f.getUsers(),a);if(h.length){a=Ext.Array.merge(a,h);Ext.Array.each(h,e)}}(b));Ext.Array.each(c.clockBoxes(),function(f){var g=f.getClockNode();if(Ext.Array.contains(a,g)){f.unDim()}else{f.dim()}});c.dimPaths(0.1,1)},dimPaths:function(a,b){var c=this;a=a||0.1;b=b||1;Ext.Array.each(c.clockPaths(),function(d){if(d.from.isDimmed()||d.to.isDimmed()){d.attr("opacity",a)}else{d.attr("opacity",b)}})},dragStartFn:function(){var a=this;ACME.configurators.clock.DrawClocks.resetHighlights();a.focus();a.highlightConnections()},dragMoveFn:function(a,g,e){var f=this,d=f.dropPath,c=f.getClockNode(),b=function(){if(d.from!==f){d.from.unFocus()}else{d.to.unFocus()}d.remove();d=null};if(e){f.highlightTargets()}if(!Ext.Array.some(f.clockBoxes(),function(h){if(f.isDropTarget(h)&&(h.getX()<=a&&a<=(h.getX()+h.getWidth()))&&(h.getY()<=g&&g<=(h.getY()+h.getHeight()))){if(d&&(d.from!==h&&d.to!==h)){b()}if(!d){h.focus();if(c.isAvailableInput(h.getClockNode())){d=ACME.configurators.clock.DrawClocks.drawPath(h,f)}else{d=ACME.configurators.clock.DrawClocks.drawPath(f,h)}}return true}})){if(d){b()}}f.dropPath=d},dragEndFn:function(){var c=this,b=c.dropPath,a=c.getClockNode();c.unFocus();ACME.configurators.clock.DrawClocks.resetHighlights();if(b){b.remove();if(b.from===c){b.to.getClockNode().setInputNode(a)}else{a.setInputNode(b.from.getClockNode())}c.dropPath=null}}},0,0,0,0,0,0,[ACME.configurators.clock.elements,"Draggable"],0));(Ext.cmd.derive("ACME.configurators.clock.elements.ClockBox",Ext.Base,{config:{clockNode:null,x:0,y:0,width:0,height:0,pathColor:"black"},constructor:function(a){var b=this;b.initConfig(a);b.elements={};b.init();return b},init:function(){var b=this,a=b.getInputBox();if(a){ACME.configurators.clock.DrawClocks.releaseColor(b);b.setPathColor(a.getPathColor())}else{b.setPathColor(ACME.configurators.clock.DrawClocks.reserveClockColor(b))}},onDrawn:function(a){var c=this,b=c.getClockNode();c.clockNodeListeners={enabledChanged:{fn:ACME.configurators.clock.DrawClocks.drawClocks,scope:ACME.configurators.clock.DrawClocks},inputNodeChanged:{fn:ACME.configurators.clock.DrawClocks.drawClocks,scope:ACME.configurators.clock.DrawClocks},outputFrequencyChanged:{fn:function(){c.updateFrequencies(a)},scope:c},frequencyWarningsChanged:{fn:function(){c.updateWarnings(a)},scope:c}};b.addListener(c.clockNodeListeners)},onDestroy:function(){var b=this,a=b.getClockNode();if(b.clockNodeListeners){a.removeListener(b.clockNodeListeners)}},drawElements:function(a){var c=this,b=c.getClockNode();c.drawClockBox(a);c.drawTitle(a);c.drawClockEnabler(a);c.drawOptionsIcon(a);c.drawAdditionalIcons(a);c.makeDraggable(c.getElement("clockBox"),[c.getElement("clockBox"),c.getElement("title")],a);if(b.isEnabled()){c.updateFrequencies(a);c.updateWarnings(a)}c.onDrawn(a);return c},drawClockBox:function(a){var c=this,b=c.getClockNode();c.elements.clockBox=a.rect(c.getX(),c.getY(),c.getWidth(),c.getHeight()).setCls(b.isEnabled()?"clockBox draggable enabled":"clockBox draggable")},drawTitle:function(a){var g=this,d=g.getClockNode(),i=d.getName();var f=i.lastIndexOf("(");if(f>0){i=i.substr(0,f)+"\n"+i.substr(f)}var j=(i.match(/\n/g)||[]).length+1;if(!d.isEnabled()){i=i.split("\n")[0];j=1}g.elements.title=a.textCss(g.getX()+g.getWidth()/2,g.getY()+5+(j*5),i).attr("title","Click, hold and drag to connect to other nodes").setCls("clockBoxHeader");var b=g.getWidth()-60;if(g.getElement("title").getBBox().width>b){var h=(b/g.getElement("title").getBBox().width).toString(),e=(g.getX()+g.getWidth()/2).toString(),c=(g.getY()+15).toString();g.getElement("title").transform("s"+h+", "+h+", "+e+", "+c)}},drawAdditionalIcons:function(a){var d=this,b=false,c=d.getClockNode();if(c.getSoftwareComponent){c.getSoftwareComponent().getInstance().clockDomainsCollection.each(function(e){if((e.get("external"))&&(e.get("external")===true)){b=true}})}if(c.getDriver()){if(c.getDriver().getConfiguration()){if(c.get("oscillatorSetting")){if(c.getDriver().getConfiguration()[c.get("oscillatorSetting").id]==="Generic clock generator input pad"){b=true}}}}if(c.isEnabled()&&b){d.elements.optionsIcon=a.image("resources/images/icons/external.png",d.getX()+d.getWidth()-60,d.getY()+d.getHeight()-30,21,21).attr({title:"External frequency defined",opacity:0.5}).setCls("clickable").click(function(){d.showOptionsDialog()})}},drawOptionsIcon:function(a){var c=this,b=c.getClockNode();if(b.isEnabled()){c.elements.optionsIcon=a.image("resources/images/icons/optionsblue.png",c.getX()+c.getWidth()-30,c.getY()+c.getHeight()-30,21,21).attr({title:ACME.Strings.clickToOpenSettings,opacity:0.5}).setCls("clickable").click(function(){c.showOptionsDialog()})}},drawClockEnabler:function(b){var e=this,d=e.getClockNode();if(!d.isAutoEnabled()){var a=d.isEnabled(),c=a?ACME.config.FontAwesomeIcons.checkboxChecked:ACME.config.FontAwesomeIcons.checkboxUnChecked,f="User specific settings for "+d.getName()+" is "+(a?"enabled":"disabled")+".  Click to "+(a?"disable":"enable");e.elements.enabler=b.drawIcon(e.getX()+15,e.getY()+15,c,f,"black").addCls("clickable").click(function(){d.enable(!d.isEnabled())})}},updateFrequencies:function(b){var d=this,c=d.getClockNode(),a=d.getElement("frequency");if(!a){d.elements.frequency=b.textCss(d.getX()+d.getWidth()/2,d.getY()+d.getHeight()-10,"").setCls("boxText");a=d.getElement("frequency")}a.attr({text:ACME.util.Convert.formatFrequency(c.getOutputFrequency())})},updateWarnings:function(b){var f=this,e=f.getClockNode(),a=null;if(!e.areInputsEnabled()){a="Input is disabled";if(e.calculateInputEnable()===0){a="Input clock is not used"}}else{if(e.getInputFrequencyWarning()||e.getOutputFrequencyWarning()){var d=[];if(e.getInputFrequencyWarning()){d.push(e.getInputFrequencyWarning())}if(e.getOutputFrequencyWarning()){d.push(e.getOutputFrequencyWarning())}a=d.join("/n")}}if(e.getdropZoneFrequencyWarning()){a=e.getdropZoneFrequencyWarning()}var c=f.getElement("warningSign");if(a){if(c){c.remove();delete f.elements.warningSign}if(!c){if(e.calculateInputEnable()===0){f.elements.warningSign=b.image("resources/images/icons/InputNotUsed.png",f.getX()+8+16,f.getY()+f.getHeight()-20,16,16);c=f.getElement("warningSign")}else{f.elements.warningSign=b.image("resources/images/icons/warning_16.png",f.getX()+8,f.getY()+f.getHeight()-20,16,16);c=f.getElement("warningSign")}}c.attr("title",a)}else{if(c){c.remove();delete f.elements.warningSign}}},showOptionsDialog:function(){var b=this,a=b.getClockNode(),c=Ext.create("ACME.configurators.clock.dialogs.ClockNodeDialog",{clockNode:a,clockNodeUsers:b.getUsers()});c.show()},getElement:function(a){var b=this;if(b.elements.hasOwnProperty(a)){return b.elements[a]}return null},getUsers:function(){var b=this,a=b.getClockNode(),c=[];Ext.Array.each(b.clockBoxes(),function(e){var d=e.getClockNode();if(d.isEnabled()){if(Ext.Array.some(e.getDropZones(),function(f){return f.getInputNode()===a})){Ext.Array.include(c,d)}}});return c},getInputBox:function(){var c=this,a=c.getClockNode(),b=a?a.getInputNode():null;return b?Ext.Array.findBy(c.clockBoxes(),function(d){return d.getClockNode()===b}):null},getDropZones:function(){var d=this,b=d.getClockNode(),c=b?b.getInputNode():null,a=[];if(c){var e={getName:function(){return b.getId()},getInputNode:function(){return c},getOffset:function(){return(d.getHeight()/2)+4},isActive:function(){return true}};a.push(e)}return a},clockBoxes:function(){return ACME.configurators.clock.DrawClocks.clockBoxes},clockPaths:function(){return ACME.configurators.clock.DrawClocks.clockPaths},dim:function(){this.addCls("dimmed")},unDim:function(){this.removeCls("dimmed")},isDimmed:function(){return this.hasCls("dimmed")},focus:function(){this.addCls("focused")},unFocus:function(){this.removeCls("focused")},addCls:function(a){var b=this;Ext.Object.eachValue(b.elements,function(c){if(c.addCls){c.addCls(a)}})},removeCls:function(a){var b=this;Ext.Object.eachValue(b.elements,function(c){if(c.removeCls){c.removeCls(a)}})},hasCls:function(a){var b=this,c=Ext.Object.getValues(b.elements);return Ext.Array.some(c,function(d){return d.hasCls&&d.hasCls(a)})},attr:function(a,c){var b=this;Ext.Object.eachValue(b.elements,function(d){if(d.attr){d.attr(a,c)}})}},1,0,0,0,0,[[ACME.configurators.clock.elements.Draggable.prototype.mixinId||ACME.configurators.clock.elements.Draggable.$className,ACME.configurators.clock.elements.Draggable]],[ACME.configurators.clock.elements,"ClockBox"],0));(Ext.cmd.derive("ACME.configurators.clock.elements.ClockModuleBox",ACME.configurators.clock.elements.ClockBox,{init:function(){var c=this,b=c.getClockNode(),a=c.getDropZones();ACME.configurators.clock.elements.ClockBox.prototype.init.call(this);if(b&&b.isEnabled()){if(a.length>2){c.setHeight(c.getHeight()+(a.length-2)*15)}}},updateFrequencies:function(a){var c=this,b=c.getClockNode();Ext.Array.each(c.getDropZones(),function(k){var g=k.getClockDomain();if(k.getInputNode()!==null){g.setFrequency(k.getInputNode().get("outputFrequency"))}var f="frequency"+k.id;var d=c.getElement(f);if(!d){c.elements[f]=a.textCss(c.getX()+5,c.getY()+k.getOffset(),"").attr({"text-anchor":"start"}).setCls("boxText smallText clickable").click(function(){b.activeClock=k.idx;c.updateFrequencies(a);c.updateWarnings(a)});d=c.getElement(f)}if(k.isActive()){d.addCls("selected")}else{d.removeCls("selected")}var i=0;i=g.getFrequency();if(k.getClockDomain().config.frequency!==null){var h=k.getClockDomain().config.frequency;var e=b.getData().softwareComponent.getData().configuration;if(e){e.$input=g.getFrequency();i=ACME.util.func.Clocks.evaluate(h.output.expression,e)}if(i<h.input.min_value){b.setdropZoneFrequencyWarning("Estimated output frequency "+ACME.util.Convert.formatFrequency(g.getFrequency())+" is below minimum recomended frequency of "+ACME.util.Convert.formatFrequency(h.input.min_value))}if(i>h.input.max_value){b.setdropZoneFrequencyWarning("Estimated output frequency "+ACME.util.Convert.formatFrequency(g.getFrequency())+" is above maximum recomended frequency of "+ACME.util.Convert.formatFrequency(h.input.max_value))}}var j=k.getName()+" "+ACME.util.Convert.formatFrequency(g.getFrequency());if(k.clockDomain){if(k.clockDomain.get("external")===true){j=ACME.util.Convert.formatFrequency(k.clockDomain.get("external_frequency"))}}d.attr({text:j})})},showOptionsDialog:function(){var b=this,a=b.getClockNode(),c=Ext.create("ACME.configurators.clock.dialogs.ClockModuleOptionsDialog",{clockNode:a,clockNodeUsers:b.getUsers()});c.show()},getDropZones:function(){var e=this,d=e.getClockNode(),b=d.getClockDomains(),a=[];var f=30;var c=d.activeClock;b.each(function(h,g){d.activeClock=g;var i={id:h.getName(),idx:g,clockDomain:h,inputNode:d.getInputNode(),offset:f,getName:function(){return i.id},getClockDomain:function(){return i.clockDomain},getInputNode:function(){return i.inputNode},getOffset:function(){return i.offset},isActive:function(){return d.activeClock===i.idx}};a.push(i);f+=15});d.activeClock=c;return a}},0,0,0,0,0,0,[ACME.configurators.clock.elements,"ClockModuleBox"],0));(Ext.cmd.derive("ACME.configurators.clock.DrawClocks",Ext.Base,{singleton:true,canvasTop:40,clockCanvasYmax:0,boxHeight:80,boxHeightSmall:40,boxGap:11,clockController:null,drawClocks:function(){var b=this;if(!b.clockController.isReady()){b.clockController.delayedDraw=true;return}b.noColumns=2+b.clockController.noSourceColumns;var a=40,c=b.clockController.getWidth()-(2*a);b.columnWidth=c/b.noColumns;b.boxWidth=b.columnWidth*0.75;b.columnPadding=(c-(b.boxWidth*b.noColumns))/(b.noColumns-1);b.columnOffset=b.boxWidth+b.columnPadding;b.clockController.delayedDraw=false;if(b.clockController.paper.raphaelReady){b.clockController.withSuspendedClockEventsDo(function(){b.resetClockBoxes();b.clockController.paper.clear();if(!b.clockController.paper.textCss){b.clockController.paper.textCss=function(f,i,h){var g=b.clockController.paper.text(f,i,h);g.node.attributes.removeNamedItem("style");g.node.attributes.removeNamedItem("font-family");g.node.attributes.removeNamedItem("font-size");g.node.attributes.removeNamedItem("fill");g.node.attributes.removeNamedItem("stroke");return g}}b.clockCanvasYmax=0;var d=a;b.drawClockOscillators(d);d+=b.columnOffset;b.drawClockSources(d);d+=b.columnOffset*b.clockController.noSourceColumns;b.drawButtons(d);var e=b.drawClockSystems(d);b.drawClockModules(d,e+b.boxHeightSmall);b.drawPaths()})}},resetClockBoxes:function(){var a=this,b=a.clockBoxes||[];b.forEach(function(c){c.onDestroy()});a.clockBoxes=[];a.clockPaths=[];a.verticalPaths=[];a.reservedColors=[]},getClockBoxForNode:function(a){var b=this,c=b.clockBoxes||[];return Ext.Array.findBy(c,function(d){return d.getClockNode()===a})},drawHeader:function(c,a){var b=this;return b.clockController.paper.textCss(a[0],a[1],c).setCls("columnHeader")},reserveClockColor:function(b){var c=this,a="black";[ACME.config.Colors.acme.PrimaryBlue,ACME.config.Colors.acme.SecondaryGreen,ACME.config.Colors.acme.PrimaryGray,ACME.config.Colors.acme.PrimaryBlue50,ACME.config.Colors.acme.SecondaryOrange,ACME.config.Colors.acme.SecondaryBlue,ACME.config.Colors.acme.SecondarySlate,ACME.config.Colors.acme.PrimaryBlue20].some(function(e,d){if(!c.reservedColors[d]||c.reservedColors[d]===b){c.reservedColors[d]=b;a=e;return true}return false});return a},releaseColor:function(a){var b=this;Ext.Array.remove(b.reservedColors,a)},drawClockBox:function(e,a,g){var f=this,b=e.isEnabled();var c={clockNode:e,x:a,y:g,width:f.boxWidth,height:b&&!(e instanceof ACME.content.model.device.clocks.ClockSystem)?f.boxHeight:f.boxHeightSmall};var d;if(e instanceof ACME.configurators.clock.model.ClockModule){d=Ext.create("ACME.configurators.clock.elements.ClockModuleBox",c)}else{d=Ext.create("ACME.configurators.clock.elements.ClockBox",c)}d.drawElements(f.clockController.paper);f.clockBoxes.push(d);return d},drawClockOscillators:function(a){var b=this;var c=b.canvasTop;b.drawHeader("Oscillators",[a+b.boxWidth/2,c-15]);b.clockController.oscillatorStore.each(function(d){var e=b.drawClockBox(d,a,c);c+=e.getHeight()+b.boxGap});b.setPaperSize(c)},drawClockSources:function(b){var e=this,f=e.canvasTop,a=[],d;e.drawHeader("Sources",[b+e.boxWidth/2,f-15]);for(d=0;d<e.clockController.noSourceColumns;d++){a.push(f)}var c=e.boxWidth+(e.clockController.getWidth()-40-(e.boxWidth*e.noColumns))/2;e.clockController.sourceStore.each(function(k){var i=k.getColumn()||0,h=b+(i*c),g=Number(a[i]);var j=e.drawClockBox(k,h,g);if(!k.hasDriver()){e.clockController.paper.textCss(h+e.boxWidth/2,g+27,"Component "+k.get("enableSetting").module+" not loaded").setCls("boxText warning smallText")}a[i]=g+(j.getHeight()+e.boxGap)});e.setPaperSize(Math.max(a))},drawClockSystems:function(a){var b=this,c=b.canvasTop;b.clockController.systemStore.each(function(e){var d=b.drawClockBox(e,a,c);c+=d.getHeight()+b.boxGap});return c},drawClockModules:function(a,d){var c=this;c.drawHeader("Components",[a+c.boxWidth/2,d-15]).attr("title","Click to Add Software Component (a)").click(function(){ACME.util.GlobalEvents.triggerShortcut("a")});var b=c.clockController.paper.image("resources/images/form/add_blue.png",a+c.boxWidth/2+60,d-25,16,16).attr("cursor","pointer").attr("title","Click to Add Software Component (a)");b.click(function(){ACME.util.GlobalEvents.triggerShortcut("a")});c.clockController.clockModules().each(function(e){if(e.isClockModule()){var f=c.drawClockBox(e,a,d);d+=f.getHeight()+c.boxGap}else{c.clockController.clockModules().remove(e)}});c.setPaperSize(d)},resetHighlights:function(){var a=this;Ext.Array.each(a.clockBoxes,function(b){b.unFocus();b.unDim()});Ext.Array.each(a.clockPaths,function(b){b.attr("opacity",1)})},highlightClockNode:function(b){var c=this,a=c.getClockBoxForNode(b);Ext.Array.each(c.clockBoxes,function(d){if(a.isDropTarget(d.getClockNode())||d.getClockNode()===b){d.attr("opacity",1)}else{d.attr("opacity",0.3)}});Ext.Array.each(c.clockPaths,function(f){var d=a.isDropTarget(f.from.clockNode)||a.isDropTarget(f.to.clockNode),e=f.from.clockNode===b||f.to.clockNode===b;if(d&&e){f.attr("opacity",0.5)}else{f.attr("opacity",0.1)}})},drawButtons:function(a){var c=this;c.clockController.paper.rect(a+(c.boxWidth/2)-75,c.canvasTop-30,150,20).setCls("button clickable").click(function(){c.clockController.resetClocks()});c.clockController.paper.textCss(a+(c.boxWidth/2),c.canvasTop-20,ACME.Strings.ResetClockSettings).setCls("buttonText clickable").click(function(){c.clockController.resetClocks()});var b=c.clockController.paper.image("resources/images/form/help.png",a+c.boxWidth/2+95,c.canvasTop-30,16,16).attr("cursor","pointer").attr("title","Display clock layout");b.click(function(){c.clockController.displayClockLayout()})},drawPaths:function(){var a=this;a.clockBoxes.forEach(function(c){var b=c.getClockNode();if(b&&b.isEnabled()){Ext.Array.each(c.getDropZones(),function(f){var e=f.getInputNode();if(e){var d=a.getClockBoxForNode(e);if(e.get("name")==="External Clock"){a.drawPath(d,c,f,"none")}else{a.drawPath(d,c,f)}}})}})},drawPath:function(l,e,c,b){b=b||"classic-midium-midium";var g=this;if(!c){c=Ext.Array.findBy(e.getDropZones(),function(p){return p.isActive()})}var d=l.getX(),f=(l.getHeight()/2)-4,j=l.getY()+f,a=e.getX()-4,k=c?c.getOffset():(e.getHeight()/2)+4,h=e.getY()+k,o=a-18;if(l.getX()<e.getX()){d+=l.getWidth()}else{if(l.getX()>e.getX()){a=e.getX()+e.getWidth()+4;o=d-18}}while(g.verticalPaths[o]&&g.verticalPaths[o]!==l){o-=7}g.verticalPaths[o]=l;var i=ACME.util.Convert.formatFrequency(l.getClockNode().getOutputFrequency());if(c.clockDomain){if(c.clockDomain.get("external")===true){i=ACME.util.Convert.formatFrequency(c.clockDomain.get("external_frequency"))}}var n=g.clockController.paper.path("M"+d+" "+j+"L"+o+" "+j+"L"+o+" "+h+"L"+a+" "+h).attr({stroke:l.getPathColor(),"arrow-end":b,title:i}).setCls("connectLine");if(l.getClockNode().isEnabled()){n.addCls("enabled")}var m={path:n,from:l,to:e,remove:function(){n.remove();Ext.Array.remove(g.clockPaths,m);Ext.Array.remove(g.verticalPaths,o)},attr:function(p,q){n.attr(p,q)}};g.clockPaths.push(m);return m},setPaperSize:function(c){var b=this;if(b.clockCanvasYmax<c){b.clockCanvasYmax=c}else{return}if(b.clockCanvasYmax>b.clockController.paper.canvas.clientHeight){var a=b.clockController.getView().getHeight();if(b.clockCanvasYmax-b.clockController.getView().getHeight()>0){a+=b.clockCanvasYmax-b.clockController.getView().getHeight()}b.clockController.paper.setSize(b.clockController.getView().getWidth(),a)}}},0,0,0,0,0,0,[ACME.configurators.clock,"DrawClocks"],0));(Ext.cmd.derive("ACME.configurators.clock.dialogs.ClockModuleOptionsDialogController",ACME.ext.app.ViewController,{control:{"#closeButton":{click:"onClose"}},externPanels:[],hbox:null,init:function(){var a=this;ACME.ext.app.ViewController.prototype.init.apply(this,this);a.initForm()},onClose:function(){var d=this,b=d.getView().getConfig(),c=b?b.clockNode:null,a=c?c.getClockDomains():null;var e=true;a.each(function(f){f.set("external",false);Ext.Array.each(d.externPanels,function(g){if(f.get("name")===g.domain.name){if(g.domain.getCurrentValue()==="External Clock"){f.set("external",true);var h=ACME.util.Convert.getNumberValueFromString(g.value.getValue());f.set("external_frequency",ACME.util.Convert.getNumberValueFromString(g.value.getValue()));f.setFrequency(h)}else{if(f.getCurrentValue()===""){f.setCurrentValue(f.getDefaultValue())}}}})});if(e===false){return}c.fireEvent("inputNodeChanged");Ext.Array.each(d.externPanels,function(f){f.value.destroy();f.domain.destroy()});if(d.hbox){d.hbox.destroy()}delete d.externPanels;d.getView().close()},initForm:function(){var f=this,c=f.getView().getConfig(),d=c?c.clockNode:null,a=d?d.getClockDomains():null;var e=f.getView().down("#clockList");e.getStore().loadData(a.getRange());var b=false;if((d.get("softwareComponent").getInstance().name.includes("FLEXCOM"))&&(d.get("softwareComponent").getId().includes("SPI"))){b=true}if((d.get("softwareComponent").getInstance().name.includes("FLEXCOM"))&&(d.get("softwareComponent").getId().includes("I2C"))){b=true}if(a){a.each(function(g){if(g.get("sources")){Ext.Array.each(g.get("sources"),function(h){if(h==="External Clock"){if(b===false){f.addExternalControls(g)}}})}})}a.each(function(g){Ext.Array.each(f.externPanels,function(h){if(g.get("name")===h.domain.name){if(g.getCurrentValue()==="External Clock"){h.value.setDisabled(false);h.value.setValue(g.get("external_frequency"))}}})})},getSourceFrequency:function(a){var b=null;this.sourceStore.each(function(c){if(c.get("name")===a){b=c.get("outputFrequency")}});return b},validationCheck:function(a){var c=this;var b=c.getView().down("#externalClock");if(a.context.value==="External Clock"){b.enable()}else{b.setDisabled(true)}},onToggleExtClock:function(d){var c=this;var a=c.getView().down("#externalClock");var b=c.getView().down("#clockList");if(d.checked===true){a.setDisabled(false);b.setDisabled(true)}else{a.setDisabled(true);b.setDisabled(false)}},addExternalControls:function(d){var b=this;b.hbox=b.getView().add(Ext.create("Ext.layout.container.HBox",{layout:{margin:"20 0 0 0",align:"stretch",type:"hbox"}}));var c=Ext.create("Ext.form.Label",{margin:"10 20 0 10",disabled:false,text:"External Clock Frequency: "+d.name});var a=Ext.create("Ext.form.field.Text",{margin:"10 5 0 10",disabled:false,allowBlank:false,maskRe:/[A-FOXa-fx0-9]/,validator:function(g){var f=true;if(isNaN(Number(g))){f=false}else{f=true}return f}});b.hbox.add(c);b.hbox.add(a);var e={domain:d,value:a};b.externPanels.push(e)},populateClockDomainSourceSelector:function(h,b){var i=this;var g=false;var c=i.getView().getConfig();var e=c?c.clockNode:null;if((e.get("softwareComponent").getInstance().name.includes("FLEXCOM"))&&(e.get("softwareComponent").getId().includes("SPI"))){g=true}if((e.get("softwareComponent").getInstance().name.includes("FLEXCOM"))&&(e.get("softwareComponent").getId().includes("I2C"))){g=true}if(b.field==="currentValue"){var f=b.column.getEditor(),d=b.record;var a=null;if(g===true){a=d.getSources().reduce(function(j,k){if(k.includes("MCK")){j.push({name:k})}return j},[])}else{a=d.getSources().reduce(function(j,k){j.push({name:k});return j},[])}f.getStore().loadData(a)}}},0,0,0,0,["controller.clockModuleOptionsDialogController"],0,[ACME.configurators.clock.dialogs,"ClockModuleOptionsDialogController"],0));(Ext.cmd.derive("ACME.configurators.clock.dialogs.ClockModuleOptionsDialog",Ext.window.Window,{title:"Component Settings",controller:"clockModuleOptionsDialogController",width:450,height:300,cls:"dialogWindow",bodyPadding:"10 10 10 10",floating:true,modal:true,draggable:true,scrollable:false,closeAction:"destroy",config:{clockNode:null},layout:{type:"vbox",align:"stretch"},defaults:{anchor:"100%",allowBlank:false,msgTarget:"side"},items:[{itemId:"clockList",xtype:"gridpanel",hideHeaders:false,enableColumnHide:false,enableColumnMove:false,sortableColumns:false,viewConfig:{stripeRows:true},store:{model:"ACME.content.model.device.clocks.ClockDomain"},columns:[{flex:1,text:"Clock",dataIndex:"name"},{flex:3,text:"Source",emptyText:"Select source",dataIndex:"currentValue",editor:{xtype:"combobox",displayField:"name",valueField:"name",store:{fields:["name"]},queryMode:"local",editable:false,forceSelection:true,allowBlank:false}}],selModel:"cellmodel",plugins:{ptype:"cellediting",clicksToEdit:1,listeners:{beforeedit:"populateClockDomainSourceSelector"}}}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",ui:"footer",layout:{pack:"end",type:"hbox"},items:[{itemId:"closeButton",xtype:"button",text:"Close"}]}]},0,0,["component","box","container","panel","window"],{component:true,box:true,container:true,panel:true,window:true},0,0,[ACME.configurators.clock.dialogs,"ClockModuleOptionsDialog"],0));(Ext.cmd.derive("ACME.configurators.clock.dialogs.ClockNodeDialogController",ACME.ext.app.ViewController,{control:{"#closeButton":{click:"onClose"}},refs:[{ref:"clockOptionsEditor"},{ref:"usedById"}],currentClocknode:null,init:function(){var a=this;ACME.ext.app.ViewController.prototype.init.apply(this,arguments);a.initForm()},onClose:function(){this.getView().close()},initForm:function(){var e=this,a=e.getView().getConfig(),b=a?a.clockNode:null,g=a?a.clockNodeUsers:null;if(b){e.currentClocknode=b;var d=b.getConfigurationSpesification();if(d!==null){d.type="section";var c=e.clockOptionsEditor.add({xtype:"configurationForm",componentId:"clockConfig-"+b.internalId,component:"myclock",layout:"fit",records:d,columns:1});c.setValues(b.getDriver().getConfiguration());c.on("change",function(j,i){var h=b.getDriver().getConfiguration();h[j]=i;b.getDriver().setConfiguration(h);b.calculateOutputFrequency();b.fireEvent("inputNodeChanged")});if(g.length){var f=g.map(function(h){return h.getName()});e.usedById.setText("Used by: "+f.join(", "))}else{e.usedById.setText(ACME.Strings.clockNotUsed+".")}}}}},0,0,0,0,["controller.clockNodeDialogController"],0,[ACME.configurators.clock.dialogs,"ClockNodeDialogController"],0));(Ext.cmd.derive("ACME.configurators.clock.dialogs.ClockNodeDialog",Ext.window.Window,{title:"Clock Settings",controller:"clockNodeDialogController",width:700,height:550,cls:"dialogWindow",bodyPadding:2,floating:true,modal:true,draggable:true,scrollable:true,closeAction:"destroy",config:{clockNode:null,clockNodeUsers:[]},layout:{type:"vbox",align:"stretch"},items:[{xtype:"panel",bodyPadding:"10 10 10 10",layout:{type:"vbox",align:"stretch"},defaults:{anchor:"100%",allowBlank:false,msgTarget:"side"},items:[{itemId:"clockOptionsEditor",xtype:"form",cls:"clockOptionsEditor"},{title:"Usage",xtype:"panel",cls:"level-two-panel",items:[{itemId:"usedById",xtype:"label"}]}]}],dockedItems:[{xtype:"toolbar",flex:1,dock:"bottom",ui:"footer",layout:{pack:"end",type:"hbox"},items:[{itemId:"closeButton",xtype:"button",text:"Close"}]}]},0,0,["component","box","container","panel","window"],{component:true,box:true,container:true,panel:true,window:true},0,0,[ACME.configurators.clock.dialogs,"ClockNodeDialog"],0));(Ext.cmd.derive("ACME.configurators.clock.ClockController",ACME.ext.app.ViewController,{control:{"#":{beforedestroy:"onDestroy",afterrender:"onRendered",activate:"onActivateVisualizer",resize:"onResize",deactivate:"onDeactivateVisualizer"},"#raphael":{raphaelReady:"onRaphaelReady"},"#helpTool":{click:"onHelp"}},refs:[{ref:"paper",selector:"#raphael"}],noSourceColumns:1,raphaelView:undefined,onEditorOpened:function(){this.delayedDraw=true},onDestroy:function(){var a=this,b=a.paper.getEl();if(b){b.un({mousedown:{fn:a.onMouseDown,scope:a},mouseup:{fn:a.onMouseUp,scope:a},mousewheel:{fn:a.onMouseWheel,scope:a}})}if(a.paper.raphaelReady){a.paper.clear();delete a.paper}},init:function(){var a=this;ACME.ext.app.ViewController.prototype.init.apply(this,arguments);ACME.configurators.clock.DrawClocks.clockController=a;a.addManagedListeners([{target:ACME.Project,softwareComponentAdded:"addClockModule",softwareComponentRemoved:"removeClockModule"},{target:a.clockModules(),endupdate:"onModuleStoreUpdated"},{target:"projectDashboard projectCanvas",editorOpened:"onEditorOpened"}]);if(ACME.Project.isDeviceReady()){a.onDeviceReady()}else{a.addManagedListener(ACME.Project,"deviceReady",a.onDeviceReady,a)}},onRendered:function(){var a=this,b=a.paper.getEl();if(b){b.on({mousedown:{fn:a.onMouseDown,scope:a},mouseup:{fn:a.onMouseUp,scope:a},mousewheel:{fn:a.onMouseWheel,scope:a}})}},onMouseDown:function(a){a.stopPropagation();a.preventDefault();this.dragStart(a)},onMouseMove:function(a){this.dragMove(a);this.dragStart(a)},onMouseUp:function(b){var a=this;if(a.dragInProgress){a.dragStop(b)}},onMouseLeave:function(a){this.dragStop(a)},onMouseWheel:function(d){var c=this;if(d.shiftKey===true){var b=d.browserEvent.wheelDelta/120,a=[d.pageX-c.getView().getX(),d.pageY-c.getView().getY()];if(b>0){c.zoomIn(b,a)}else{c.zoomOut(Math.abs(b),a)}}},dragStart:function(b){var a=this;ACME.configurators.clock.DrawClocks.resetHighlights();a.dragInProgress=true;a.startX=b.pageX;a.startY=b.pageY;a.paper.getEl().on({mousemove:{fn:a.onMouseMove,scope:a,single:true},mouseup:{fn:a.onMouseUp,scope:a,single:true},mouseleave:{fn:a.onMouseLeave,scope:a,single:true}})},dragMove:function(d){var c=this,b=d.pageX-c.startX,a=d.pageY-c.startY;if(c.paper){c.paper.moveCanvas(b,a)}},dragStop:function(b){var a=this;a.dragInProgress=false;a.paper.getEl().un({mousemove:{fn:a.onMouseMove,scope:a,single:true},mouseup:{fn:a.onMouseUp,scope:a,single:true},mouseleave:{fn:a.onMouseLeave,scope:a,single:true}});a.dragMove(b)},setScaleCenter:function(a){var b=this;if(a){b.paper.setScaleCenter(a[0],a[1],"scaled")}else{b.paper.setScaleCenter(b.paper.getWidth()/2,b.paper.getHeight()/2,"scaled")}},zoomIn:function(b,a){var c=this;if(c.paper){b=b||1;c.setScaleCenter(a);c.paper.scaleCanvas(Math.pow(1.25,b),"relative")}},zoomOut:function(b,a){var c=this;if(c.paper){b=b||1;c.setScaleCenter(a);c.paper.scaleCanvas(Math.pow(0.8,b),"relative")}},resetZoomAndPan:function(){var a=this;if(a.paper){a.paper.scaleCanvas(1,"absolute");a.paper.moveCanvas(0,0,"absolute")}},getWidth:function(){var b=this,a=b.getView();return a?a.getWidth():700},clockModules:function(){if(!this.clockModulesCollection){this.clockModulesCollection=Ext.create("Ext.util.Collection",{rootProperty:"data"})}return this.clockModulesCollection},onRaphaelReady:function(){var a=this;if(a.delayedDraw){ACME.configurators.clock.DrawClocks.drawClocks()}},active:false,delayedDraw:false,onActivateVisualizer:function(b){var a=this;a.raphaelView=b;a.active=true;if(a.delayedDraw){Ext.Function.defer(function(){ACME.configurators.clock.DrawClocks.drawClocks()},25,a)}},onDeactivateVisualizer:function(){this.active=false;this.delayedDraw=true},isReady:function(){var a=this;if(!a.paper){return false}return a.active&&a.paper.raphaelReady},onResize:function(){ACME.configurators.clock.DrawClocks.drawClocks()},suspendClockEvents:function(){var a=this;if(a.systemStore){a.systemStore.suspendEvents()}a.oscillatorStore.suspendEvents();a.sourceStore.suspendEvents()},resumeClockEvents:function(){var a=this;if(a.systemStore){a.systemStore.resumeEvents()}a.oscillatorStore.resumeEvents();a.sourceStore.resumeEvents()},withSuspendedClockEventsDo:function(a){var b=this;b.suspendClockEvents();a.call(b);b.resumeClockEvents()},onDeviceReady:function(){var b=this,a=ACME.Project.getDevice();if(!a){return}b.systemStore=a.clockSystems();b.oscillatorStore=a.clockOscillators();b.sourceStore=a.clockSources();b.initializeClockModules();ACME.configurators.clock.DrawClocks.drawClocks()},onRemove:function(){var a=this;a.removeManagedListeners([{target:ACME.Project,softwareComponentAdded:"addClockModule",softwareComponentRemoved:"removeClockModule"}])},initializeClockModules:function(){var a=this;ACME.Project.drivers().each(function(b){a.addClockModule(b)})},addClockModule:function(c){var b=this;if(c.getType()==="driver"&&c.get("instance")){if(!c.isSystemDriver()){var a=b.clockModules().findBy(function(d){return d.getSoftwareComponent()===c});if(!a){b.clockModules().add(Ext.create("ACME.configurators.clock.model.ClockModule",{softwareComponent:c}))}}}b.oscillatorStore.each(function(d){d.calculateOutputFrequency()});b.sourceStore.each(function(d){d.calculateOutputFrequency()});b.clockModules().each(function(d){d.calculateOutputFrequency()})},removeClockModule:function(c){var b=this;var a=b.clockModules().find("softwareComponent",c);if(a){b.clockModules().remove(a)}},resetHighlights:function(){ACME.configurators.clock.DrawClocks.resetHighlights()},onModuleStoreUpdated:function(){ACME.configurators.clock.DrawClocks.drawClocks()},onHelp:function(){window.open(ACME.config.Documentation.clockConfiguration)},displayClockLayout:function(){window.open(ACME.config.Documentation.clockConfiguration)},resetClocks:function(){var b=this;ACME.LoadMask.show("resetclocks","Resetting clocks");b.suspendClockEvents();function c(){b.resumeClockEvents();ACME.LoadMask.hide("resetclocks")}function a(d){b.oscillatorStore.each(function(e){e.reset(d)});b.sourceStore.each(function(e){e.reset(d)});b.clockModules().each(function(e){e.reset(d)});c();ACME.configurators.clock.DrawClocks.drawClocks()}if(ACME.Project.isRestored()){Ext.Msg.confirm({title:ACME.Strings.build(["Reset","clocks"]),cls:"messageBox",message:"Reset to device defaults or saved project?",buttons:Ext.Msg.YESNOCANCEL,buttonText:{yes:"Device defaults",no:"Saved project",cancel:ACME.Strings.build(["Yes"])},fn:function(d){if(d==="yes"){a("defaultSettings")}else{if(d==="no"){a("defaultProjectSettings")}else{c()}}}})}else{Ext.Msg.confirm({title:ACME.Strings.build(["Reset","clocks"]),cls:"messageBox",message:"Reset to device defaults?",buttons:Ext.Msg.YESNO,buttonText:{yes:ACME.Strings.build(["Yes"]),no:ACME.Strings.build(["No"])},fn:function(d){if(d==="yes"){a("defaultSettings")}else{c()}}})}}},0,0,0,0,["controller.clockVisualizer"],0,[ACME.configurators.clock,"ClockController"],0));(Ext.cmd.derive("ACME.configurators.clock.Clock",Ext.container.Container,{controller:"clockVisualizer",scrollable:"vertical",tools:[{itemId:"helpTool",type:"help",tooltip:"Help",enableToggle:true}],items:[{xtype:"panel",height:"100%",layout:"fit",items:[{itemId:"raphael",xtype:"component",height:"100%",cls:"clockCanvas",plugins:[{ptype:"raphael",injectGroup:true}]}]}]},0,["clockVisualizer"],["component","box","container","clockVisualizer"],{component:true,box:true,container:true,clockVisualizer:true},["widget.clockVisualizer"],0,[ACME.configurators.clock,"Clock"],0));(Ext.cmd.derive("ACME.configurators.clock.ClockConfiguratorController",ACME.configurators.ConfiguratorController,{control:{"#zoomInButton":{click:"zoomIn"},"#zoomOutButton":{click:"zoomOut"},"#fitButton":{click:"resetZoomAndPan"}},refs:[{ref:"clockVisualizer",selector:"clockVisualizer"}],zoomIn:function(){var a=this;a.clockVisualizer.getController().zoomIn()},zoomOut:function(){var a=this;a.clockVisualizer.getController().zoomOut()},resetZoomAndPan:function(){var a=this;a.clockVisualizer.getController().resetZoomAndPan()},onActivated:function(){this.clockVisualizer.fireEvent("activate",this.getView())},onDeactivated:function(a,b){this.clockVisualizer.fireEvent("deactivate",a,b)},onRemove:function(){var b=this,a=b.clockVisualizer.getController();if(a){a.onRemove()}}},0,0,0,0,["controller.clockConfigurator"],0,[ACME.configurators.clock,"ClockConfiguratorController"],0));(Ext.cmd.derive("ACME.configurators.clock.ClockConfigurator",ACME.configurators.Configurator,{alternateClassName:"ACME.configurators.Clock",title:"Clock configurator",controller:"clockConfigurator",config:{identifier:"clocks",name:"Clocks",image:"resources/images/buttonicons/clock.png",tooltip:'"Go to clock configurator  (shortcut c)"',shortcutKey:"c"},padding:4,dashboardTools:[{type:"help",tooltip:"Clock help",handler:"onHelp",helpUrl:ACME.config.Documentation.clockConfiguration}],layout:"fit",items:[{xtype:"panel",height:"100%",layout:"fit",tbar:[{itemId:"zoomInButton",xtype:"button",iconCls:"x-tool-img x-tool-plus",text:"Zoom in"},{itemId:"zoomOutButton",xtype:"button",iconCls:"x-tool-img x-tool-minus",text:"Zoom out"},{itemId:"fitButton",xtype:"button",iconCls:"x-fa fa-arrows-alt",text:"Reset"}],items:[{xtype:"clockVisualizer",width:"100%"}]}]},0,["clockConfigurator"],["component","box","container","dashboardCard","clockConfigurator"],{component:true,box:true,container:true,dashboardCard:true,clockConfigurator:true},["widget.clockConfigurator"],0,[ACME.configurators.clock,"ClockConfigurator",ACME.configurators,"Clock"],0));(Ext.cmd.derive("ACME.configurators.noclock.Controller",ACME.configurators.ConfiguratorController,{init:function(){var a=ACME.Project.getDevice();if(a){if(a.get("architecture")){if(a.get("architecture")==="AVR8"){var b=ACME.app.getDashboard().getController().projectCanvas;if(b){if(!ACME.Options.get("showSystemDrivers")){b.toggleSystemDrivers()}}}}}}},0,0,0,0,["controller.noClockConfigurator"],0,[ACME.configurators.noclock,"Controller"],0));(Ext.cmd.derive("ACME.configurators.noclock.Model",Ext.app.ViewModel,{formulas:{noClocksAvailable:function(){var a="<p>No clocks are available on for this device</p>",b=ACME.Project.getDevice();if(b){if(b.get("architecture")==="AVR"){a="AVR Clocks can not be configured from code, but are defined using fuses. See ";a+="<a href="+ACME.config.ExternalLinks.getDataSheetLink(b.get("name"))+">Datasheet</a>";a+=" and ";a+="<a href="+ACME.config.ExternalLinks.atmelStudioMicrosite+">Atmel Studio</a>"}}return a},clockIllustrationSrc:function(){var b="resources/images/categories/72/clock.png",a=ACME.Project.getDevice();if(a){if(a.get("architecture")==="AVR"){b="resources/images/avrclocks3d.png"}}return b},clockIllustrationAlt:function(){var b="Clocks",a=ACME.Project.getDevice();if(a){if(a.get("architecture")==="AVR8"){b="AVR Clocks"}}return b}}},0,0,0,0,["viewmodel.noClockConfigurator"],0,[ACME.configurators.noclock,"Model"],0));(Ext.cmd.derive("ACME.configurators.noclock.View",ACME.configurators.Configurator,{alternateClassName:"ACME.configurators.NoClock",title:"Clock configurator",controller:"noClockConfigurator",viewModel:{type:"noClockConfigurator"},config:{identifier:"clocks",name:"Clocks",image:"resources/images/buttonicons/clock.png",tooltip:'"Go to clock configurator  (shortcut c)"',shortcutKey:"c"},margin:0,padding:0,cls:"noclock",layout:{type:"vbox",align:"stretch"},items:[{xtype:"component",bind:{html:"{noClocksAvailable}"}},{xtype:"container",flex:1,layout:"center",items:[{title:"Clocks",alt:"Clocks",xtype:"image",width:"100%",height:"100%",maxWidth:"100%",maxHeight:"100%",cls:"obj-contain",bind:{title:"{clockIllustrationAlt}",src:"{clockIllustrationSrc}",alt:"{clockIllustrationAlt}"}}]}]},0,0,["component","box","container","dashboardCard"],{component:true,box:true,container:true,dashboardCard:true},0,0,[ACME.configurators.noclock,"View",ACME.configurators,"NoClock"],0));